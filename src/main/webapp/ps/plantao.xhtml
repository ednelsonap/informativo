<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="_template_ps.xhtml">
	<ui:define name="titulo">
		<title>Plantão PS</title>
	</ui:define>

	<ui:define name="conteudo">

		<div>
			<p:linkButton outcome="/ps/painel.xhtml" value="Ver Painel"
				target="_blank" style="margin-right:20px;"
				styleClass="rounded-button ui-button-success" icon="pi pi-eye"
				ajax="false" />
		</div>

		<!-- FORMULÁRIO DE VÍNCULO DOS MÉDICOS NO PLANTAO DO PS -->

		<h:form id="formPlantao">
			<p:card id="cardMedico" style="text-align: center;">
				<f:facet name="title">
        		Vínculo de Médicos
    		</f:facet>
				<f:facet name="subtitle">
        		Plantão da unidade #{plantaoPsBean.plantaoPrincipal.unidade}
    		</f:facet>

				<p>Para vincular um profissional ao plantão, selecione-o na
					lista e clique em vincular</p>

				<p:selectOneMenu value="#{plantaoPsBean.medicoId}" id="medico"
					style="text-transform: uppercase" filter="true"
					filterMatchMode="startsWith">
					<f:selectItem itemLabel="Selecione" itemValue="" />
					<f:selectItems value="#{plantaoPsBean.medicos}" var="medico"
						itemLabel="#{medico.nome} - #{medico.especialidade.descricao}"
						itemValue="#{medico.id}" />
				</p:selectOneMenu>

				<f:facet name="footer">
					<p:commandButton value="Vincular" icon="pi pi-link"
						action="#{plantaoPsBean.adicionarMedicoNoPlantao}" process="@form"
						ajax="false" update="@form :formPlantaoCadastrado:tabelaMedicos" />
				</f:facet>
			</p:card>
		</h:form>

		<!-- TABELA DE MÉDICOS VINCULADOS AO PLANTAO PS -->

		<h:form id="formPlantaoCadastrado">
			<p:dataTable id="tabelaMedicos" var="medico"
				value="#{plantaoPsBean.medicosPlantaoPrincipal}"
				emptyMessage="Nenhum Médico no plantão" style="margin-top: 20px;">

				<f:facet name="header">
						MÉDICOS DO PLANTÃO
					</f:facet>

				<p:column headerText="Nome" style="width: 500px;">
					<h:outputText value="#{medico.nome}" />
				</p:column>

				<p:column headerText="CRM" style="width: 100px;">
					<h:outputText value="#{medico.crm}" />
				</p:column>

				<p:column headerText="Especialidade">
					<h:outputText value="#{medico.especialidade.descricao}" />
				</p:column>

				<p:column headerText="Ações" style="width: 100px;">
					<p:commandButton update="@form" process="@this"
						actionListener="#{plantaoPsBean.removerMedicoDoPlantao(medico)}"
						title="Desvincular" icon="pi pi-link"
						styleClass="rounded-button ui-button-danger ui-button-outlined" />
				</p:column>
			</p:dataTable>

		</h:form>

		<!-- CADASTRO ASSISTENTES SOCIAIS -->

		<h:form id="formAssistentesSociaisPlantao">

			<div align="center">
				<p:fieldset legend="Assistentes Sociais" style="margin-top: 20px;">
					<p:panelGrid columns="4">
						<p:outputLabel value="Selecione a(o) Assistente Social:"
							for="assistenteSocial" />
						<p:selectOneMenu value="#{plantaoPsBean.assistenteSocialId}"
							id="assistenteSocial">
							<f:selectItem itemLabel="Selecione" itemValue="" />
							<f:selectItems value="#{plantaoPsBean.assistentesSociais}"
								var="assistenteSocial" itemLabel="#{assistenteSocial.nome}"
								itemValue="#{assistenteSocial.id}" />
						</p:selectOneMenu>
						<p:commandButton value="Vincular" icon="pi pi-link"
							action="#{plantaoPsBean.adicionarAssistenteSocialNoPlantao}"
							process="formAssistentesSociaisPlantao" ajax="false"
							update=":formAssistentesSociaisCadastrados:tabelaAssistentesSociais">
						</p:commandButton>

						<p:commandLink value="Cadastrar Novo Assistente Social"
							action="/assistentesocial?faces-redirect=true" immediate="true"
							update="@all" />
					</p:panelGrid>
				</p:fieldset>
			</div>
			<br />
		</h:form>

		<h:form id="formAssistentesSociaisCadastrados">
			<p:dataTable id="tabelaAssistentesSociais" var="assistenteSocial"
				value="#{plantaoPsBean.assistentesSociaisPlantaoPrincipal}"
				emptyMessage="Nenhum Assistente Social no plantão"
				style="margin-top: 20px;">

				<f:facet name="header">
						ASSISTENTES SOCIAIS DO PLANTÃO
					</f:facet>

				<p:column headerText="Nome">
					<h:outputText value="#{assistenteSocial.nome}" />
				</p:column>

				<p:column headerText="CRESS">
					<h:outputText value="#{assistenteSocial.cress}" />
				</p:column>

				<p:column headerText="Ações" style="width: 100px;">
					<p:commandButton update="@form" process="@this"
						actionListener="#{plantaoPsBean.removerAssistenteSocialDoPlantao(assistenteSocial)}"
						title="Desvincular" icon="pi pi-link"
						styleClass="rounded-button ui-button-danger ui-button-outlined" />
				</p:column>
			</p:dataTable>
		</h:form>
	</ui:define>
</ui:composition>
</html>